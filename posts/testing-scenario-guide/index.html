<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="google-site-verification" content="NqibrxbTQ3FPfyJuuSPcSi39c5Qiqf57zoBYqWxd2dg" /><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Training SOC - Test Scenario Guide" /><meta property="og:locale" content="en_US" /><meta name="description" content="Overview The purpose of this guide is to aid in the replication and maintenance of our OpenStack cloud by documenting the deployment process." /><meta property="og:description" content="Overview The purpose of this guide is to aid in the replication and maintenance of our OpenStack cloud by documenting the deployment process." /><link rel="canonical" href="https://bsu-cybersecurity.github.io//posts/testing-scenario-guide/" /><meta property="og:url" content="https://bsu-cybersecurity.github.io//posts/testing-scenario-guide/" /><meta property="og:site_name" content="Institute for Pervasive Cybersecurity" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-03-17T14:00:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Training SOC - Test Scenario Guide" /><meta name="twitter:site" content="@boisestate" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"Overview The purpose of this guide is to aid in the replication and maintenance of our OpenStack cloud by documenting the deployment process.","headline":"Training SOC - Test Scenario Guide","dateModified":"2021-06-15T19:38:28+00:00","datePublished":"2021-03-17T14:00:00+00:00","url":"https://bsu-cybersecurity.github.io//posts/testing-scenario-guide/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://bsu-cybersecurity.github.io//posts/testing-scenario-guide/"},"@context":"https://schema.org"}</script><title>Training SOC - Test Scenario Guide | Institute for Pervasive Cybersecurity</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Institute for Pervasive Cybersecurity"><meta name="application-name" content="Institute for Pervasive Cybersecurity"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang=""><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://cdn.jsdelivr.net/gh/BSU-Cybersecurity/BSU-Cybersecurity.github.io@main/assets/img/favicon.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Institute for Pervasive Cybersecurity</a></div><div class="site-subtitle font-italic">A leader of innovative cybersecurity research and advancement in Idaho and the region.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/bsu-cybersecurity" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/boisestate" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['cyberinstitute','boisestate.edu'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Training SOC - Test Scenario Guide</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Training SOC - Test Scenario Guide</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Institute for Pervasive Cybersecurity </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Mar 17, 2021, 2:00 PM +0000" >Mar 17<i class="unloaded">2021-03-17T14:00:00+00:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Tue, Jun 15, 2021, 1:38 PM -0600" >Jun 15<i class="unloaded">2021-06-15T19:38:28+00:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2394 words">13 min read</span></div></div><div class="post-content"><h2 id="overview">Overview</h2><p>The purpose of this guide is to aid in the replication and maintenance of our OpenStack cloud by documenting the deployment process.</p><h3 id="versions">Versions</h3><p>The software versions we use in our environment are as follows:</p><ul><li>Ubuntu 20.04 LTS (Focal) for the MAAS server, Juju client, Juju controller, and all cloud nodes (including containers)<li>MAAS 2.9.2<li>Juju 2.7.6<li>OpenStack Wallaby</ul><h3 id="hardware-layout-5-nodes">Hardware Layout (5 Nodes)</h3><div class="table-wrapper"><table><thead><tr><th>Name<th>Description<tbody><tr><td>Client Machine<td>Machine used to SSH into the MAAS Controller, or MAAS nodes.<tr><td>MAAS Controller<td>This machine is not part of the OpenStack cloud - it simply manages the “metal” of the cloud by power-cycling machines and network booting and deploying OS images.<tr><td>JuJu Controller<td>One of the nodes managed by MAAS. Not to be confused with the JuJu application that lives within the MAAS Controller. The JuJu Controller orchestrates the commands given to the JuJu application and hosts the JuJu dashboard.<tr><td>node0-3<td>These MAAS managed nodes (tagged “compute”) are where the OpenStack Charm containers get deployed to. These nodes form the actual OpenStack cloud.</table></div><h3 id="deployment-process">Deployment Process</h3><p>The first step in deployment is to configure the hardware (servers) so they can play nicely with the MAAS Application later in the deployment process. It is important to ensure all minimal hardware requirements are met.</p><p>Next, there needs to be some thought put into network architecture, and the Network Set-Up section lists some of the considerations.</p><p>Ubuntu Server 20.04 LTS needs to be With hardware and network configuration done, installed on a server separate from the OpenStack cluster - this server is referred to as the “MAAS Controller”. The MAAS Application is then installed on the MAAS Controller using the Snap Store, and is then configured appropriately.</p><p>The servers that are part of the OpenStack cluster (which are referred to as JuJu Controller, Node0, Node1, Node2, and Node3) need to then be enlisted on MAAS, and set to a “ready” state to be “deployed” later on by JuJu. This process is covered in the MAAS Enlisting section.</p><p>Before any JuJu magic can happen, the JuJu Application needs to be installed on the MAAS Controller using the Snap Store - all JuJu commands will be run on the MAAS Controller command line, but will be orchestrated by the JuJu Controller.</p><p>To actually deploy the JuJu Controller hardware (and nodes later on), the JuJu Application needs to have API access to MAAS. This quick set-up process is outlined in the JuJu Configuration section. And once JuJu can control MAAS-managed hardware through API, the actual JuJu controller can be bootstrapped and deployed - this is done through command line on the MAAS Controller as described in the JuJu Deployment section.</p><p>With the JuJu Controller deployed, the OpenStack installation can begin. This (lengthy and tedious) process is described step-by-step under “Open Stack Installation”. The OpenStack cloud then needs to be configured for non-admin access and use, and managed for maintenance, scalability and power events - all of which is outlined in detail in the OpenStack Management section.</p><h2 id="hardware">Hardware</h2><h3 id="minimum-requirements">Minimum Requirements</h3><div class="table-wrapper"><table><thead><tr><th>Name<th>CPUs (cores)<th>RAM (GB)<th>Storage<th>NIC’s<tbody><tr><td>MAAS Controller<td>2<td>8<td>1x 40GB<td>1<tr><td>JuJu Controller<td>2<td>4<td>1x 40GB<td>1<tr><td>Node0<td>2<td>8<td>3x 80GB<td>2<tr><td>Node1<td>2<td>8<td>3x 80GB<td>2<tr><td>Node2<td>2<td>8<td>3x 80GB<td>2<tr><td>Node3<td>2<td>8<td>3x 80GB<td>2</table></div><h3 id="configuration">Configuration</h3><h4 id="dell-poweredge-servers">Dell PowerEdge Servers</h4><p>Our environment consists of Dell PowerEdge servers (no iDRAC license), so set-up steps are mostly identical across servers aside from varying hardware generations - and this process goes as follows for each server that will be managed by MAAS:</p><ul><li>Connect a display and keyboard (and mouse if preferred) to the server.<li>Power on the server and wait until the boot menu on the top of the screen is displayed - at this point press F10 (Life Cycle Manager) on the keyboard and wait for the screen to load.<li>Once in Life Cycle Manager we need to set up the following:</ul><h2 id="network">Network</h2><h3 id="architecture">Architecture</h3><h4 id="serving-dhcp">Serving DHCP</h4><p>We have the option to let our router or MAAS serve DHCP, and both options have their implications.</p><h4 id="letting-maas-serve-dhcp">Letting MAAS Serve DHCP</h4><p>When MAAS is serving DHCP, MAAS will automatically discover a server that is PXE booting on the same network. When a server is booting over PXE, MAAS takes over by providing a boot image and automatically listing the node under “Machines” on the MAAS Application GUI - and if IPMI was set up correctly, MAAS will automatically configure the IPMI. Though this is very convenient, the downside however, is that the Firewall/Router won’t manage DHCP leases.</p><h4 id="letting-the-firewallrouter-serve-dhcp">Letting the Firewall/Router Serve DHCP</h4><p>Alternatively, we can let the router serve DHCP. The main consideration here (as far as MAAS is concerned) is that we will have to manually enlist new servers by MAC and IP address, which isn’t a super tedious process but it is something to consider.</p><h2 id="maas">MAAS</h2><h3 id="controller">Controller</h3><p>One server that isn’t part of the OpenStack cluster (but is on the same network) needs to be the designated “MAAS Controller”. The MAAS Controller will “manage” the hardware (servers), meaning it can power on/off + deploy operating system images to each of the servers networked in the OpenStack cluster.</p><h4 id="installing-the-operating-system">Installing the Operating System</h4><p>Though most Debian Linux distributions would work, our MAAS Controller runs Ubuntu Server Focal 20.04 LTS.</p><h4 id="a-few-pointers">A Few Pointers</h4><ul><li>If DHCP is being served by MAAS and there are no other DHCP servers, then Ubuntu won’t be able to automatically configure the network during the installation process - it will need to be configured manually (see below). Alternatively, you may decide to enable serving DHCP on the router during this process, and then disable it once the MAAS application is installed and configured.</ul><p>[INSERT IMAGE]</p><ul><li>It is infinitely easier to manage the MAAS Controller over SSH, however, Ubuntu Server comes out of the box with UFW, so SSH needs to be allowed through the firewall. To allow ssh, input the following command.<div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">sudo </span>ufw allow ssh
</pre></table></code></div></div></ul><h3 id="installation">Installation</h3><p>With Ubuntu configured on the MAAS Controller, the MAAS application needs to be installed using the Snap Store by inputting this command:</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">sudo </span>snap <span class="nb">install</span> <span class="nt">--channel</span><span class="o">=</span>2.9/stable maas
</pre></table></code></div></div><p>MAAS needs a database backend, which can be installed using the following commands.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">sudo </span>apt update <span class="nt">-y</span>
<span class="nv">$ </span><span class="nb">sudo </span>apt <span class="nb">install</span> <span class="nt">-y</span> postgresql
</pre></table></code></div></div><p>A user for the database then needs to be created. Input the following command - the $VARIABLE’s need to be replaced appropriately and documented for future reference.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-u</span> postgres psql <span class="nt">-c</span> <span class="s2">"CREATE USER </span><span class="se">\"</span><span class="nv">$MAAS_DBUSER</span><span class="se">\"</span><span class="s2"> WITH ENCRYPTED PASSWORD '</span><span class="nv">$MAAS_DBPASS</span><span class="s2">'"</span>
</pre></table></code></div></div><p>Then the database needs to be created with the user created above. Run the following command replacing the $VARIABLE’s.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-u</span> postgres createdb <span class="nt">-O</span> <span class="s2">"</span><span class="nv">$MAAS_DBUSER</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$MAAS_DBNAME</span><span class="s2">"</span>
</pre></table></code></div></div><p>A postgres config file now needs to be edited to reflect the new database user and database name. At the time of writing this guide, the latest stable version of postgres is version 12, so the following command will use vim to open the file in this directory - <code class="language-plaintext highlighter-rouge">/etc/postgresql/12/main/pg_hba.conf</code> using root privilege. In the event this doesn’t work, manually navigate to this directory, you likely have a different version of postgres installed so the ‘12’ in the directory may be a different number.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">sudo </span>vim /etc/postgresql/12/main/pg_hba.conf
</pre></table></code></div></div><p>With the <code class="language-plaintext highlighter-rouge">pg_hba.conf</code> file open, add the following line at the end, and save the file.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>host    <span class="nv">$MAAS_DBNAME</span>    <span class="nv">$MAAS_DBUSER</span>    0/0     md5
</pre></table></code></div></div><p>Now it is time to initialize the MAAS application using the command below. Replace the variables as appropriate, and since we are running the MAAS application on our MAAS Controller, the <code class="language-plaintext highlighter-rouge">$HOSTNAME</code> should be set to <code class="language-plaintext highlighter-rouge">localhost</code>.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">sudo </span>maas init region+rack <span class="nt">--database-uri</span> <span class="s2">"postgres://</span><span class="nv">$MAAS_DBUSER</span><span class="s2">:</span><span class="nv">$MAAS_DBPASS</span><span class="s2">@</span><span class="nv">$HOSTNAME</span><span class="s2">/</span><span class="nv">$MAAS_DBNAME</span><span class="s2">"</span>
</pre></table></code></div></div><p>Note that the IP of the web GUI is printed out on the terminal during this step. Press enter unless you want to make any changes. If you specified that the <code class="language-plaintext highlighter-rouge">$HOSTNAME</code> was <code class="language-plaintext highlighter-rouge">localhost</code>, the IP of the web GUI is the same as that of the MAAS Controller machine.</p><p>Finally, a MAAS admin user needs to be created.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">sudo </span>maas createadmin
</pre></table></code></div></div><p>You will be prompted to input user credentials - these will be used to log into the web GUI so make sure to document these for future use.</p><p>Now check the status of the MAAS application using the following command</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">sudo </span>maas status
</pre></table></code></div></div><p>The output should be similar to the following.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">sudo </span>maas status
bind9                        RUNNING   pid 22236, <span class="nb">uptime </span>0:01:02
dhcpd                        STOPPED   Not started
dhcpd6                       STOPPED   Not started
http                         RUNNING   pid 22461, <span class="nb">uptime </span>0:00:42
ntp                          RUNNING   pid 22372, <span class="nb">uptime </span>0:00:45
proxy                        RUNNING   pid 22604, <span class="nb">uptime </span>0:00:34
rackd                        RUNNING   pid 22241, <span class="nb">uptime </span>0:01:02
regiond                      RUNNING   pid 22248, <span class="nb">uptime </span>0:01:02
syslog                       RUNNING   pid 22366, <span class="nb">uptime </span>0:00:45

</pre></table></code></div></div><p>If any services are not running, follow this process to re-initialize MAAS.</p><p>At this point the MAAS web GUI should be accessible from a web browser on a machine sharing the same network as the MAAS Controller.</p><h3 id="initial-set-up">Initial Set-Up</h3><p>Access the MAAS web GUI from your local browser. You should be able to access it as long as you are on the same network as the MAAS Controller and MAAS is running. [INSERT IMAGE]</p><p>Log in to the MAAS web GUI and follow the set-up process. The steps are mostly straight-forward.</p><p>[INSERT IMAGE]</p><h4 id="import-ssh-keys">Import SSH Keys</h4><p>In the next step of the initial set-up, you will be asked to input an ssh-key so that you can ssh into the machines MAAS deploys using RSA key authentication instead of a password. Grab the machine you intend to use to SSH into the MAAS-deployed nodes and retrieve the RSA key pair of that machine. If you are on a Linux machine and you have already generated SSH keys, the key can usually be retrieved from the default directory by entering the following command.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">sudo cat</span> /home/<span class="nv">$USERNAME</span>/.ssh/id_rsa.pub
</pre></table></code></div></div><p>More than likely though, you will need to generate your “private/public key pair”. To generate the RSA key pair enter the following command. Follow the shell prompts and take note of the directory and passphrase (if any) used.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ssh-keygen <span class="nt">-t</span> rsa <span class="nt">-b</span> 4096
</pre></table></code></div></div><p>If you saved the RSA key pair to the default directory you will be able to retrieve your public key with the following command.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">sudo cat</span> /home/<span class="nv">$USERNAME</span>/.ssh/id_rsa.pub
</pre></table></code></div></div><p>The output of this will look something like this:</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC/2sats4R9ino4qZfNiPFL+PYAVjY6vdRP9G9KJZPyxeOhbcpUPQ88gf2TpjEhy9CICweJ9Wt71uhkyh7iL4nW2ZN1oPyF9jzJTTfxPyAGjV6cOOPC1ispOgmFu3ZklGpRXAaNYsgIpp5FGGyioIAatzDuBjHffYEEXqmj6qkamRhCZZdMl7EBxa0rwsTlOfdY72ohpqwqUQr6QFMpvnSO1VFTjQJIXSvpDBigdhYsL0TxH+4S9UG+ywBQunhaOpX34Z6bIQT1rfZbDEfMh/C6qcQQSFghclhCjvqn2V7FNkiYcIuImf18xLQMnZU2NKRM9x2inhdjWUXvpihJbVzZuZ03AAm0NF1H2va3fBMJrTAXKLf4wTj1k+841+d59EVD6eUGW94p3sAzkC39FQMizv1PovFCSFFjNt5zFJWEFjMNYJWvLmx2DUnEnn7Qsmjw8U66YcI03FxWwW1sab+hbsS9y5rjOlUIDc1zjHlfRZmqf0obAghcQ852WvRYKv6TJ/WE2RQtUXg0/lJjtG70+mnrOxqAE3Pk2kT2gZumhk01VlvZCVBz8bLNdZ3r5jjEVYJ/MChQW7Uv828EtA1fayXqXLtIrYZxCPcvA99GKN3/xT0HNGWSYdrelVf0CZ207aVjJuP2mfDr5DWZ9PhXxiiz/hF6TP1abKOqNfsb8w<span class="o">==</span> controller@maas
</pre></table></code></div></div><p>You will need to copy this output and paste it into the MAAS web GUI. [INSERT IMAGE]</p><p>With the RSA public key imported, continue through the initial set-up. Once you land on the page below there are a couple things that still need to be configured. [INSERT IMAGE]</p><h4 id="configuration-1">Configuration</h4><h4 id="enable-dhcp">Enable DHCP</h4><p>This step only applies if you’ve decided to let MAAS serve DHCP, as described in the Serving DHCP section of this guide.</p><p>To enable DHCP click on the “Controllers” tab at the top, and select the controller (called maas.maas in this case).</p><h2 id="openstack">OpenStack</h2><p>We will be using JuJu to orchestrate the OpenStack deployment one individual “charm” container at a time. OpenStack can also be deployed via “bundles” - for instructions on a bundle deployment follow the official guide on the OpenStack website.</p><p>Per the official guide: <em>“There are many moving parts involved in a charmed OpenStack install. During much of the process there will be components that have not yet been satisfied, which will cause error-like messages to be displayed in the output of the juju status command. Do not be alarmed. Indeed, these are opportunities to learn about the interdependencies of the various pieces of software. Messages such as Missing relation and blocked will vanish once the appropriate applications and relations have been added and processed.”</em></p><h3 id="installation-1">Installation</h3><p>First, make sure you are interacting with the correct juju controller and model.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>juju switch juju-controller:openstack
</pre></table></code></div></div><p>With that out of the way, it may be useful to monitor the deployment progress either through the JuJu dashboard or using the JuJu status command.</p><h4 id="monitoring-the-openstack-deployment">Monitoring the OpenStack Deployment</h4><p>To access the JuJu dashboard, enter the following command.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>juju dashboard
</pre></table></code></div></div><p>The output will look something like this.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nv">$ </span>juju dashboard
Dashboard 0.6.2 <span class="k">for </span>controller <span class="s2">"juju-controller"</span> is enabled at:
  https://192.168.1.240:17070/dashboard
Your login credential is:
  username: admin
  password: 536d568fb04609daee40c61abc36844d

</pre></table></code></div></div><p>Alternatively, to monitor JuJu status use this command.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>watch <span class="nt">-n</span> 1 <span class="nt">-c</span> juju status <span class="nt">--color</span>
</pre></table></code></div></div><h3 id="ceph-osd">Ceph-OSD</h3><p>The first charm we will deploy is the Ceph-osd charm or “object storage device”. This is done by first creating a YAML file called <strong>ceph-osd.yaml</strong> which specifies the charm’s configurations, where <code class="language-plaintext highlighter-rouge">/dev/sdb</code> is the path to the</p><div lang="yaml" class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="na">ceph-osd</span><span class="pi">:</span>
  <span class="na">osd-devices</span><span class="pi">:</span> <span class="s">/dev/sdb</span>
  <span class="na">source</span><span class="pi">:</span> <span class="s">cloud:focal-wallaby</span>
</pre></table></code></div></div><p>Next, we will deploy the Ceph-osd charm to 4 nodes. Since we only have compute nodes, the “compute” tag constraint is not necessary strictly speaking, but it is good practice for future deployments.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>juju deploy <span class="nt">-n</span> 4 <span class="nt">--config</span> ceph-osd.yaml <span class="nt">--constraints</span> <span class="nv">tags</span><span class="o">=</span>compute ceph-osd
</pre></table></code></div></div><p>With this being the first charm deployed to the compute nodes, MAAS will first power on the servers and deploy Ubuntu 20.04 to each node - and once that is done, JuJu will proceed to install the charm software. You can monitor the progress using the JuJu status command output - it will look like this once the Ceph-osd charm is finished installing.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>Model      Controller       Cloud/Region  Version  SLA          Timestamp
openstack  juju-controller  maas-cloud    2.8.10   unsupported  05:09:54Z

App       Version  Status   Scale  Charm     Store       Rev  OS      Notes
ceph-osd  16.2.0   blocked      4  ceph-osd  jujucharms  310  ubuntu

Unit         Workload  Agent  Machine  Public address  Ports  Message
ceph-osd/0  blocked  idle  0  192.168.1.241  Missing relation: monitor
ceph-osd/1<span class="k">*</span> blocked  idle  1  192.168.1.235  Missing relation: monitor
ceph-osd/2  blocked  idle  2  192.168.1.236  Missing relation: monitor
ceph-osd/3  blocked  idle  3  192.168.1.237  Missing relation: monitor

Machine  State    DNS            Inst <span class="nb">id  </span>Series  AZ       Message
0        started  192.168.1.241  node0  focal   default  Deployed
1        started  192.168.1.235  node1  focal   default  Deployed
2        started  192.168.1.236  node2  focal   default  Deployed
3        started  192.168.1.237  node3  focal   default  Deployed
</pre></table></code></div></div><h3 id="nova-compute">Nova Compute</h3><p>With the Ceph-osd installed, the Nova Compute charm is next on the list of deployment. The process is very similar across charms. First, create the file <strong>nova-compute.yaml</strong>.</p><div lang="yaml" class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="na">nova-compute</span><span class="pi">:</span>
  <span class="na">config-flags</span><span class="pi">:</span> <span class="s">default_ephemeral_format=ext4</span>
  <span class="na">enable-live-migration</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">enable-resize</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">migration-auth-type</span><span class="pi">:</span> <span class="s">ssh</span>
  <span class="na">openstack-origin</span><span class="pi">:</span> <span class="s">cloud:focal-wallaby</span>
</pre></table></code></div></div><p>Then, deploy the Nova Compute charm using the file nova-compute.yaml configurations.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>juju deploy <span class="nt">-n</span> 3 <span class="nt">--to</span> 1,2,3 <span class="nt">--config</span> nova-compute.yaml nova-compute
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/training-soc/'>Training-SOC</a>, <a href='/categories/scenario/'>Scenario</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/soc/" class="post-tag no-text-decoration" >soc</a> <a href="/tags/guide/" class="post-tag no-text-decoration" >guide</a> <a href="/tags/scenario/" class="post-tag no-text-decoration" >scenario</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"></div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Training SOC - Test Scenario Guide - Institute for Pervasive Cybersecurity&url=https://bsu-cybersecurity.github.io//posts/testing-scenario-guide/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Training SOC - Test Scenario Guide - Institute for Pervasive Cybersecurity&u=https://bsu-cybersecurity.github.io//posts/testing-scenario-guide/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Training SOC - Test Scenario Guide - Institute for Pervasive Cybersecurity&url=https://bsu-cybersecurity.github.io//posts/testing-scenario-guide/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', '')" data-toggle="tooltip" data-placement="top" title=""> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/training-soc-Security-Onion-Host-Agents/">Security Onion - Host Agents</a><li><a href="/posts/Virtual-City-Network-Design/">Virtual City Network Design</a><li><a href="/posts/training-soc-tools-pfsense/">Tools - PfSense</a><li><a href="/posts/security-onion-deployment/">Security Onion Deployment</a><li><a href="/posts/proxmox-networking-SDN/">Proxmox - SDN</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/soc/">soc</a> <a class="post-tag" href="/tags/guide/">guide</a> <a class="post-tag" href="/tags/deployment/">deployment</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/openstack/">openstack</a> <a class="post-tag" href="/tags/juju/">juju</a> <a class="post-tag" href="/tags/maas/">maas</a> <a class="post-tag" href="/tags/charms/">charms</a> <a class="post-tag" href="/tags/client/">client</a> <a class="post-tag" href="/tags/tools/">tools</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/openstack-deployment-hardware/"><div class="card-body"> <span class="timeago small" >Jul 26<i class="unloaded">2021-07-26T14:00:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Openstack Deployment - Hardware</h3><div class="text-muted small"><p> Configuration Dell PowerEdge Servers BSU’s SOC environment consists of Dell PowerEdge servers (no iDRAC license), so set-up steps are mostly identical across servers. Connect a display and keyb...</p></div></div></a></div><div class="card"> <a href="/posts/proxmox-deployment-hardware/"><div class="card-body"> <span class="timeago small" >Jul 27<i class="unloaded">2021-07-27T14:00:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Proxmox Deployment - Hardware</h3><div class="text-muted small"><p> Configuration Dell PowerEdge Servers RAID BSU’s SOC environment consists of Dell PowerEdge servers (no iDRAC license), so set-up steps are mostly identical across servers aside from varying hardwar...</p></div></div></a></div><div class="card"> <a href="/posts/proxmox-networking-SDN/"><div class="card-body"> <span class="timeago small" >Jul 27<i class="unloaded">2021-07-27T14:00:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Proxmox - SDN</h3><div class="text-muted small"><p> In Proxmox cross node LAN networking can be accomplished through the use of software defined networking. In order to imitate seperate networks, while utilizing multiple nodes within these networ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/openstack-deployment-overview/" class="btn btn-outline-primary" prompt="previous"><p>OpenStack Deployment - Overview</p></a> <a href="/posts/training-soc-tools-osquery/" class="btn btn-outline-primary" prompt="next"><p>Tools - OSQuery</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//.disqus.com/embed.js', disqusConfig: function() { this.page.title = 'Training SOC - Test Scenario Guide'; this.page.url = 'https://bsu-cybersecurity.github.io//posts/testing-scenario-guide/'; this.page.identifier = '/posts/testing-scenario-guide/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/boisestate">Institute for Pervasive Cybersecurity</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the guides on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by Boise State University.">Some rights reserved.</span></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/soc/">soc</a> <a class="post-tag" href="/tags/guide/">guide</a> <a class="post-tag" href="/tags/deployment/">deployment</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/openstack/">openstack</a> <a class="post-tag" href="/tags/juju/">juju</a> <a class="post-tag" href="/tags/maas/">maas</a> <a class="post-tag" href="/tags/charms/">charms</a> <a class="post-tag" href="/tags/client/">client</a> <a class="post-tag" href="/tags/tools/">tools</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://BSU-Cybersecurity.github.io/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
